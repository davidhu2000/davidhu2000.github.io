---
import type { GetStaticPathsOptions } from "astro";

import { SITE } from "../../config";
import type { IPageProps } from "../../helpers/staticPathProps";
import BlogList from "../../layouts/BlogList.astro";
import PageLayout from "../../layouts/PageLayout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
  const posts = (await getCollection("blog")).sort(
    (a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
  );

  return paginate(posts, {
    pageSize: SITE.postsPerPage,
  });
}

interface Props extends IPageProps {}
const { page } = Astro.props;

const currentPage = page.currentPage ?? 1;

const title = `Blog ${currentPage > 1 ? `— Page ${currentPage} ` : ""}— ${SITE.name}`;
const description = "The list of blog posts written by David Hu";
const canonical = new URL("/blog", Astro.site);
---

<PageLayout meta={{ title, description, canonical }}>
  <BlogList title={`Here Lies My Articles...`} page={page} />
</PageLayout>
